<extend name="Public/base" />

<block name="body">
	<div id="userAdd">
		<div class="ui top attached tabular menu">
			<div class="item active" data-tab="tab-name">基本信息</div>
			<div class="item" data-tab="tab-name" style="cursor: pointer;" id="salaryModal">薪资信息</div>
		</div>
		<div class="ui bottom attached segment tab active" data-tab="tab-name">
			<form action="{:U()}" method="post" class="form-horizontal ui form">
				<div class="fields">
					<div class="field">
						<label>工号</label>
						<input type="text" name="uid" value="{$find.uid}" readonly placeholder="自动生成">
					</div>
					<div class="field">
						<label>姓名</label>
						<input type="text" name="username" value="{$find.realname}">
					</div>
					<div class="field">
						<label>联系电话</label>
						<input type="text" name="phone" value="{$find.phone}">
					</div>
					<div class="field">
						<label>性别</label>
						<div class="ui radio checkbox mr15">
							<input type="radio" name="sex" value="1" tabindex="0" class="hidden" {$find.nan} <if condition="$sone.isstaff eq 0"> checked="" </if>>
							<label>男</label>
						</div>
						<div class="ui radio checkbox mr15">
							<input type="radio" name="sex" value="0" tabindex="0" class="hidden" {$find.nv} <if condition="$sone.isstaff neq 0"> checked="" </if>>
							<label>女</label>
						</div>
					</div>
				</div>
				<div class="fields">
					<div class="field">
						<label>QQ号</label>
						<input type="text" name="qq" value="{$find.qq}">
					</div>
					<div class="field">
						<label>紧急联系人姓名</label>
						<input type="text" name="criticalname" value="{$find.criticalname}">
					</div>
					<div class="field">
						<label>紧急联系人电话</label>
						<input type="text" name="criticalphone" value="{$find.criticalphone}">
					</div>
					<div class="field">
						<label>出生日期</label>
						<input type="text" name="birthday" value="{$find.birthday}" id="birthday">
					</div>
				</div>
				<div class="fields">
					<div class="field">
						<label>民族</label>
						<input type="text" name="nation" value="{$find.nation}">
					</div>
					<div class="field">
						<label>政治面貌</label>
						<input type="text" name="political" value="{$find.political}">
					</div>
					<div class="field">
						<label>身份证号</label>
						<input type="text" name="IDnumber" value="{$find.IDnumber}">
					</div>
					<div class="field">
						<label>专业</label>
						<input type="text" name="major" value="{$find.major}">
					</div>
				</div>
				<div class="fields">
					<div class="field">
						<label>毕业学校</label>
						<input type="text" name="school" value="{$find.school}">
					</div>
					<div class="field">
						<label>最高学历</label>
						<input type="text" name="topeducation" value="{$find.topeducation}">
					</div>
					<div class="field">
						<label>婚姻状况</label>
						<select class="ui dropdown dropdown-init" name="matrimonial">
							<option value="未婚" <if condition="$find.matrimonial eq '未婚'"> selected </if>>未婚</option>
							<option value="已婚" <if condition="$find.matrimonial eq '已婚'"> selected </if>>已婚</option>
							<option value="离异" <if condition="$find.matrimonial eq '离异'"> selected </if>>离异</option>
							<option value="丧偶" <if condition="$find.matrimonial eq '丧偶'"> selected </if>>丧偶</option>
						</select>
					</div>
					<div class="field">
						<label>籍贯</label>
						<input type="text" name="nativeplace" value="{$find.nativeplace}">
					</div>
				</div>
				<div class="fields">
					<div class="field">
						<label>现居地址</label>
						<input type="text" name="nowliveplace" value="{$find.nowliveplace}">
					</div>
					<div class="field">
						<label>入职时间</label>
						<input type="text" name="entrytime" value="{$find.entrytime}" class="form_datetime">
					</div>
					<div class="field">
						<label>转正日期</label>
						<input type="text" name="completiontime" value="{$find.completiontime}" class="form_datetime">
					</div>
					<div class="field">
						<label>状态</label>
						<div class="ui radio checkbox mr15">
							<input type="radio" name="iscompletion" value="1" tabindex="0" class="hidden" {$find.shi}>
							<label>正式</label>
						</div>
						<div class="ui radio checkbox mr15">
							<input type="radio" name="iscompletion" value="0" tabindex="0" class="hidden" <empty name="find.fou && find.shi">checked=""<else />{find.fou}</empty>>
							<label>试用</label>
						</div>
					</div>
				</div>				
				<div class="fields">
					<div class="field">
						<label>所属部门</label>
						<select class="ui dropdown" name="did" id="department">
							<volist name="department" id="vo">
								<option value="{$vo.did}" <eq name="vo.did" value="$sel[0]['did']"> selected="selected" </eq>>{$vo.dname}</option>
							</volist>
						</select>
					</div>
					<div class="field">
						<label>所属岗位</label>
						<div class="ui selection dropdown" id="sid">	
							<input type="hidden" name="sid" value="{$sel[0]['sid']}">
							<i class="dropdown icon"></i>
							<div class="default text"></div>
							<div class="menu">							
								<volist name="station" id="vo">
									<div class="item" data-value="{$vo.sid}" isstaff='{$vo.isstaff}'>{$vo.stationname}</div>
								</volist>
							</div>
						</div>						
					</div>
				</div>
				<div class="form-item">
					<button class="ui blue button submit-btn ajax-post mr20" type="submit" id="submit" target-form="form-horizontal">确 定</button>
					<button class="ui blue button btn-return" onclick="javascript:history.back(-1);return false;">返 回</button>
				</div>
			</form>
			<!--<div class="salary ui form">
				<div class="ui divider"></div>
				<div class="fields">
					<div class="field">
						<input type="password" name="password" placeholder="输入二级密码查看薪资" autocomplete="off">
					</div>
				</div>
				<button class="ui blue button" type="submit" >确 定</button>
			</div>
			<iframe src="{:U('User/salary')}" width="100%" height="300px" border="0" style="border: 0px; overflow: hidden;"></iframe>-->
		</div>
	</div>
	<div class="ui modal small user-edit-modal">
		<div class="header">
			薪资查看二级密码验证
		</div>
		<div class="content">
			<div class="ui form">
				<div class="field">
				<label>请输入你6位数的二级密码</label>
				<input type="password" id="salaryPassword" autocomplete="off">
				<p id="errorMsg"></p>
			</div>
			</div>
		</div>
		<div class="actions">
			<div class="ui button cancel">取消</div>
			<div class="ui blue button" id="salaryPost">确定</div>
		</div>
	</div>
</block>

<block name="script">
	<script type="text/javascript">
		$(function() {
			//薪资接口
			$("#salaryModal").click(function(){
				$('.ui.modal').modal('show');
			})
			$("#salaryPost").click(function(){
				var uid = {$find.uid};
				var password = $("#salaryPassword").val();
				if(password.length != 6){
					$("#errorMsg").html("密码错误");
					return;
				}
				$.post("__APP__/Admin/Uapi/salary",{uid:uid,password:password},function(data){
					var data = $.parseJSON(data);
					if(data.status){
						window.location.href = "__APP__/Admin/User/salary/uid/"+data.data.uid;
					}else{
						$("#errorMsg").html(data.msg);
					}
				})
			})
			var departmentJosn = <?php echo json_encode($department)?>;
			$('.ui.radio.checkbox').checkbox();
			$('.dropdown-init,#sid').dropdown();
			$("#department").dropdown({
				onChange: function(value, text, $selectedItem) {
					$("#sid").dropdown('clear');
					dropdownSwitch(value);
				}
			})
			var did = $("#department").dropdown('get value')[0];
			dropdownSwitch(did);
			function dropdownSwitch(did){
				for (var i = 0; i < departmentJosn.length; i++) {
					if(did == departmentJosn[i].did){
						if(departmentJosn[i].sid){
							var html = '';
							for(var j in departmentJosn[i].sid){
								html += '<div class="item" data-value="'+j+'">'+departmentJosn[i].sid[j]+'</div>';
							}
							$("#sid .menu").html(html);
						}else{
							alert("此部门出错，请联系管理员");
						}
					}
				}
			}
			$(".form_datetime").datetimepicker({
				format: 'yyyy-mm-dd',
				language: "zh-CN",
	            minView: 2,
	            startView: 2,
	            autoclose: true,
			});
			//出生日期
	        $('#birthday').datetimepicker({
	            format: 'yyyy-mm-dd',
	            language: "zh-CN",
	            minView: 2,
	            startView:4,
	            autoclose: true,
	        })


		})
	</script>
</block>